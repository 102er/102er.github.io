---
layout: post
title: '学会看explain执行计划'
date: 2019-05-18
author: blossom
cover: 'http://on2171g4d.bkt.clouddn.com/jekyll-banner.png'
tags: explain mysql
---

> SQL优化，先学会看explain。在了解了mysql优化器执行sql的过程，我们才能更好的优化sql

### 基础
优化sql，必须使用的一个命令：explain，它能模拟mysql优化器执行sql查询语句，从而知道mysql是如何处理我们写的sql语句。有了执行过程的信息，我们就可以
针对性的优化sql，或者表结构。

### explain输出字段
![explain](https://blossom102er.github.io/assets/img/explain2.png)

    * id：select查询的标识符，每个select都会自动分配一个唯一的id，id的值越大，代表优先级越高，越先执行。（如果id相同，执行顺序由上而下执行）
    * select_type：select查询的类型，区分复杂的查询。
            * simple：简单的select查询，不包含子查询或者union
            * primary：查询中含有复杂的子部分，在外层查询会标记为primary
            * subquery：select或者where包含子查询，则子查询标记为subquery
            * derived：from中包含子查询会被标记为derived
            * union：union后面出现select在会被标记为union。若包含在from的子查询中，则外层的select会被标记为derived
            * union result：表示从union的临时表中读取数据
    * table：查询的表名，不一定是真实的表，有可能临时表
    * partitions：查询时匹配到的分区信息，没有分区一般显示null
    * type：访问类型，既查找数据表的方式，非常重要的一个指标，性能优先级排列顺序： ALL< index< range < index_subquery < unique_subquery < index_merge < ref_or_null < ref< eq_ref< const< system
            * All：full table scan，mysql会遍历全表找到匹配的行
            * index：full index scan，遍历索引树找到匹配的行
            * range：索引范围扫描，对索引的扫描开始于某一点，返回匹配值域的行，比如bettween and < > <= in 等查询条件。
            * index_subquery：
            * unique_subquery：
            * index_merge：使用了索引合并优化法，查询使用了两个以上的索引
            * ref：使用了非唯一的索引，会找到很多个符合条件的行
            * eq_ref：查询命中了主键索引或者唯一索引
            * const：查询命中了primary key或者unique key 或者被连接的部分是常量值。扫描效率高，返回数据量小。
            * system：表只有一行记录情况，少见。
    * possible_type：表示mysql能使用哪些索引进行数据检索，查询的字段涉及索引会被列出，但是列出的索引不一定会被查询使用。
    * key：实际使用的索引，没有则为null
    * ken_len：索引的长度，原则上是越短越好；只计算where中用到的索引，order by 和 group by中的索引不会计算长度。
    * ref：表示上述表的连接匹配条件，即哪些列或者常量被用于查找索引列上的值，常见值：const，func，null，字段名。
    * rows：表示mysql根据统计信息以及索引选用情况，估算找到所需的记录所需要读取的行数，衡量sql查询指标的一个重要指标，一般情况来说rows越小越好。
    * extra：额外结果信息显示在此列。列下常见的信息，具体更多可以翻看官方文档。
            * using index：相应的select操作中使用了覆盖索引（覆盖索引：一条sql只需要通过索引就可以返回，比如 select index_a from a 其中index_a就是索引，这种情况不需要再去关联数据查询）
            * using where：查询时未找到可用索引，通过where条件过滤获取所需要的数据
            * using temporary：查询结果需要使用临时表存储，一般order 或者 group 会用到
            * using filesort：无法利用索引完成的排序操作。
            * using join buffer：联表查询的时候，如果表的连接没有索引，需要用一个连接缓冲区存中间结果
            * impossible where：不太正确的where，导致没有符合条件的column
            * No tables used： 没有from部分或者使用了from dual

### 总结
以上只是总结explain的字段说明，只有了解了这些字段说明，我们在sql优化时，才能有针对性。
通过explain我们可以知道：
* 表的读取顺序
* 数据读取操作的操作类型
* 可以使用哪些索引，以及实际使用了哪些索引
* 查询了多少行数据
这些都有助于我们去优化sql语句，所以，入门级sql优化，必先掌握explain的用户。

详细的explain输出字段解释可以参考官方文档：详细的信息可以参考官方的文档：https://dev.mysql.com/doc/refman/5.7/en/explain-output.html
