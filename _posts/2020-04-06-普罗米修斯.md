---
layout: post
title: '普罗米修斯'
date: 2020-04-16
author: blossom
cover: 'http://on2171g4d.bkt.clouddn.com/jekyll-banner.png'
tags: 监控 普罗米修斯 prometheus
---

> 介绍普罗米修斯，搭建普罗米修斯

### 基础
Prometheus是基于时序列数据库（TSDB）的开源监控系统，具有多维度数据模型，方便部署和维护，灵活的数据采集以及强大的查询语言等特性；
采用go语言开发；
### 特性
* 一个多维数据模型，包含由 metric 和 key/value 标识的时间序列数据
* PromQL是一种灵活的查询语言
* 不依赖分布式存储，单个服务器节点是自治的
* 基于 HTTP 协议通过 pull 形式进行收集时间序列数据
* push 形式的时间序列数据是通过一个中间网关来支持的
* targets 可以通过服务发现或静态配置发现的
* 多种模式的图形和仪表盘支持

### 官方架构图：

![prometheus架构图](https://blossom102er.github.io/assets/img/prometheus.png)
主要包含Prometheus server Pushgateway PromQL Alertmanager等组件。

#### Prometheus server
prometheus的核心组件，负责数据收集和存储。
* 定期从配置好的jobs或者exporters拉取metrics，或者从pushgateway接收metrics；
* Prometheus server会运行定义好的alert.rules 记录新的时间序列或者向alertmanager推送告警

#### Pushgateway
推送网关，接收agent server推送的告警，供Prometheus server拉取数据；
主要应用于短生命周期的jobs采集，因为短周期的jobs，可能在server还没来得及pull就已经消失了。

#### Alertmanager
告警生成以及通知告警组件，接收Prometheus server推送的告警，根据配置文件，对告警进行处理以及通报；
具备去重功能，可以对重复的alerts进行去重。

#### PromQL
数据查询语言，grafana或者其他api通过promQL来查询使用数据。

### 
### 服务搭建
